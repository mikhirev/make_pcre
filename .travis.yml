language: c
compiler:
  - gcc
  - clang
env:
  - MAKE_VER=4.0
  - MAKE_VER=4.1
before_install:
  - sudo apt-get update -q
  - wget http://ftp.gnu.org/gnu/make/make-${MAKE_VER}.tar.bz2 -O - | bunzip2 | tar -xvC /tmp
install:
  - sudo apt-get install -yq libpcre3-dev
  - pushd /tmp/make-${MAKE_VER} && ./configure && make -j2 && sudo make install ; popd
  - sudo pip install cpp-coveralls
script: /usr/local/bin/make check $([ "$CC" = gcc ] && echo "CFLAGS='-Wall -g -fprofile-arcs -ftest-coverage'")
after_success:
  - test "$CC" = gcc && coveralls
